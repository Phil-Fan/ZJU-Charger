# ğŸ”‹ ğ™ğ‰ğ” ğ‚ğ¡ğšğ«ğ ğğ«

![Star Badge](https://img.shields.io/github/stars/Phil-Fan/ZJU-Charger?style=social) ![License Badge](https://img.shields.io/github/license/Phil-Fan/ZJU-Charger) ![Contributors Badge](https://img.shields.io/github/contributors/Phil-Fan/ZJU-Charger) ![Issues Badge](https://img.shields.io/github/issues/Phil-Fan/ZJU-Charger) ![Pull Requests Badge](https://img.shields.io/github/issues-pr/Phil-Fan/ZJU-Charger) ![Last Commit Badge](https://img.shields.io/github/last-commit/Phil-Fan/ZJU-Charger) ![Code Size Badge](https://img.shields.io/github/languages/code-size/Phil-Fan/ZJU-Charger)

[![Markdown Quality Check](https://github.com/Phil-Fan/ZJU-Charger/actions/workflows/markdown-check.yml/badge.svg)](https://github.com/Phil-Fan/ZJU-Charger/actions/workflows/markdown-check.yml) [![Python Lint Check](https://github.com/Phil-Fan/ZJU-Charger/actions/workflows/python-check.yml/badge.svg)](https://github.com/Phil-Fan/ZJU-Charger/actions/workflows/python-check.yml) [![pages-build-deployment](https://github.com/Phil-Fan/ZJU-Charger/actions/workflows/pages/pages-build-deployment/badge.svg)](https://github.com/Phil-Fan/ZJU-Charger/actions/workflows/pages/pages-build-deployment)

ä½ æ˜¯å¦ä¹Ÿæ›¾éª‘ç€æ²¡ç”µçš„å°é¾Ÿï¼Œæ…¢åååœ°éª‘åˆ°å……ç”µæ¡©ï¼Œå´å‘ç°ä¸€ä¸ªç©ºä½™çš„æ¡©ä½éƒ½æ²¡æœ‰ï¼ŸğŸ˜«
ä½ æ˜¯å¦ä¹Ÿæ›¾è¢«å……ç”µæ¡©æœåŠ¡å•†ç¦»è°±çš„ UI ç•Œé¢ä¸å¤æ‚çš„æŸ¥è¯¢æ¥å£æ‰€å›°æ‰°ï¼ŸğŸ˜ 

ZJU Charger åŸºäº FastAPI å¼€å‘ï¼Œç„å‡†**æ ¡å†…å……ç”µæ¡©ä¸å¥½æ‰¾ã€ä¾›åº”å•†å…¥å£ä¸ä¸€ã€ä½¿ç”¨çŠ¶æ€æŸ¥è¯¢ä¸ä¾¿**ä¸‰å¤§ç—›ç‚¹ï¼Œä¸ºä½ æä¾›ä¸€ä¸ªç®€æ´ã€æ˜“ç”¨ã€æ‰©å±•æ€§å¼ºçš„å……ç”µæ¡©æŸ¥è¯¢æ–¹æ¡ˆã€‚

ç›®å‰æ”¯æŒç½‘ç«™åœ¨çº¿åˆ†æ ¡åŒºã€åˆ†æœåŠ¡å•†æŸ¥è¯¢ï¼ˆæ™®æŸ¥ï¼‰ã€iOS å¿«æ·æŒ‡ä»¤æŸ¥è¯¢ç‰¹å®šç«™ç‚¹çŠ¶æ€ï¼ˆç²¾å‡†æŸ¥ï¼‰ã€é’‰é’‰ Webhook æœºå™¨äººç­‰åŠŸèƒ½ã€‚

è®¿é—® [https://charger.philfan.cn/](https://charger.philfan.cn/web/) æŸ¥çœ‹æ•ˆæœã€‚

> **å…è´£å£°æ˜**ï¼šæœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ äº¤æµï¼Œä¸å¾—ç”¨äºå•†ä¸šç›ˆåˆ©ä¸éæ³•ç”¨é€”ã€‚ä½¿ç”¨æœ¬é¡¹ç›®æ‰€é€ æˆçš„ä»»ä½•åæœï¼Œç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ï¼Œä½œè€…ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚è¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚

## åŠŸèƒ½ç‰¹æ€§

-### å‰ç«¯åŠŸèƒ½

- [x] React + Vite + Tailwind æ„å»º SPAï¼Œç»„ä»¶åŒ– Header/åœ°å›¾/åˆ—è¡¨/å…³æ³¨æ§ä»¶ã€‚
- [x] Apache ECharts + `echarts-extension-amap` æ¸²æŸ“å•ä¸€é«˜å¾·åº•å›¾ï¼Œæ ‡è®°æŒ‰å¯ç”¨æ€§è‡ªåŠ¨ç€è‰²ï¼ˆç»¿=ç©ºé—²ã€æ©™=ç´§å¼ ã€çº¢=æ— ç©ºé—²ï¼‰ã€‚
- [x] æ ¡åŒº/æœåŠ¡å•†ç­›é€‰ã€å¤œé—´æ¨¡å¼ã€ç«™ç‚¹å…³æ³¨åˆ—è¡¨ã€æœ¬åœ°å­˜å‚¨åå¥½ä¸è‡ªåŠ¨åˆ·æ–°ã€‚
- [x] åœ°å›¾æ”¯æŒå®šä½ + ç«™ç‚¹å¯¼èˆªï¼ˆæç¤º/åŒå‡»æ‰“å¼€é«˜å¾·æˆ–ç³»ç»Ÿåœ°å›¾é“¾æ¥ï¼‰ï¼Œç«™ç‚¹åˆ—è¡¨ä¿ç•™è¿›åº¦æ¡ã€å…³æ³¨æ’åºã€å¤œé—´æç¤ºç­‰äº¤äº’ã€‚
- [x] æ ¡åŒºæ‘˜è¦æ¦‚è§ˆï¼šåœ¨åœ°å›¾é¡¶éƒ¨å³æ—¶çœ‹åˆ°å„æ ¡åŒºç©ºé—²æ¡©æ•°é‡ã€‚
  - æµ…è‰²æ¨¡å¼
    ![web-light](assets/web_light.png)
  - æ·±è‰²æ¨¡å¼
    ![web-dark](assets/web_dark.png)

### åç«¯åŠŸèƒ½

- [x] åå°å®šæ—¶æŠ“å–ä»»åŠ¡ï¼Œè‡ªåŠ¨æ›´æ–°ç¼“å­˜
- [x] Supabase æ•°æ®åº“æ”¯æŒï¼Œè®°å½•å†å²ä½¿ç”¨æƒ…å†µæ•°æ®ï¼ˆå¯é€‰ï¼‰
- [x] FastAPI ç»Ÿä¸€ API æ¥å£ï¼Œä½¿ç”¨ slowapi å®ç°æ¥å£é™æµåŠŸèƒ½
- [x] å¤šæœåŠ¡å•†æ¶æ„æ”¯æŒï¼Œå¯åŒæ—¶å¼‚æ­¥æŠ“å–å¤šä¸ªæœåŠ¡å•†çš„å……ç”µæ¡©æ•°æ®ï¼ˆç›®å‰æ”¯æŒäº†å°¼æ™®é¡¿æœåŠ¡å•†ï¼‰

### å¿«æ·æŒ‡ä»¤

[ZJU Charger.shortcut](https://www.icloud.com/shortcuts/1545aeee457046dbacba42ef0ab6285d)

æ”¯æŒå¿«é€ŸæŸ¥è¯¢å…³æ³¨çš„å‡ ä¸ªç«™ç‚¹çš„çŠ¶æ€ï¼Œå¹¶å¯ä»¥æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥çœ‹ã€‚
æ“ä½œæ­¥éª¤è¯¦è§ [Script å¿«æ·æŒ‡ä»¤æ–‡æ¡£](./docs/06-script-shortcuts.md#ä½¿ç”¨æ–¹æ³•)ã€‚

![shortcut](assets/shortcut_result.jpg)

### é’‰é’‰ Webhook æœºå™¨äºº

![dingbot](assets/dingbot.png)

## æ–‡æ¡£

è¯¦ç»†çš„æ–‡æ¡£è¯·æŸ¥çœ‹ [docs](./docs/) ç›®å½•ï¼š

- [å¿«é€Ÿå¼€å§‹](./docs/01-quick-start.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [Web ä»‹ç»ä¸éƒ¨ç½²](./docs/02-web-deployment.md) - å‰ç«¯åŠŸèƒ½è¯´æ˜å’Œéƒ¨ç½²æŒ‡å—
- [Server ç«¯éƒ¨ç½²](./docs/03-server-deployment.md) - åç«¯æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—
- [Fetcher æ–‡æ¡£](./docs/04-fetcher.md) - å¦‚ä½•æ·»åŠ æ–°æœåŠ¡å•†ã€æ›´æ–°ç«™ç‚¹ä¿¡æ¯
- [é’‰é’‰æœºå™¨äººæ–‡æ¡£](./docs/05-dingbot.md) - é’‰é’‰æœºå™¨äººé…ç½®å’Œä½¿ç”¨
- [Script å¿«æ·æŒ‡ä»¤æ–‡æ¡£](./docs/06-script-shortcuts.md) - iOS å¿«æ·æŒ‡ä»¤ä½¿ç”¨æŒ‡å—
- [Supabase æ•°æ®åº“æ¶æ„](./docs/07-supabase-schema.md) - Supabase æ•°æ®åº“è¡¨ç»“æ„å’Œä½¿ç”¨è¯´æ˜
- [API å‚è€ƒ](./docs/08-api.md) - åç«¯ REST API æè¿°ä¸ç¤ºä¾‹

## Web éƒ¨ç½²

1. å®‰è£…ä¾èµ–å¹¶å‡†å¤‡ç¯å¢ƒå˜é‡ï¼š

   ```bash
   cd web
   npm install
   cp .env.example .env  # è®¾ç½® VITE_AMAP_KEYã€å¯é€‰çš„ VITE_API_BASE ç­‰
   ```

2. æœ¬åœ°è°ƒè¯•ï¼š`npm run dev`ï¼ŒVite ä¼šåœ¨ `http://localhost:5173` æä¾›çƒ­æ›´æ–°ï¼ŒAPI é»˜è®¤æŒ‡å‘åŒæº FastAPIï¼ˆæˆ–é€šè¿‡ `VITE_API_BASE` æŒ‡å‘è¿œç«¯ APIï¼‰ã€‚

3. ç”Ÿæˆé™æ€å†…å®¹ï¼š`npm run build`ï¼ˆå¯é€‰ `npm run preview` éªŒè¯ï¼‰ã€‚`dist/` äº¤ç»™ä»»æ„é™æ€æ‰˜ç®¡ï¼ˆå¦‚ GitHub Pagesã€Cloudflare Pagesã€Caddy/Nginx ç­‰ï¼‰ï¼›FastAPI åªæš´éœ² `/api/*`ï¼Œä¸å†è´Ÿè´£å‰ç«¯æ–‡ä»¶ã€‚

4. å‰åç«¯åˆ†ç¦»éƒ¨ç½²æ—¶ï¼ŒåŠ¡å¿…åœ¨æ„å»ºå‰è®¾ç½® `VITE_API_BASE=https://your-api-domain`ï¼ˆä¾‹å¦‚ `https://charger.philfan.cn`ï¼‰ï¼Œä½¿æµè§ˆå™¨å‘æ­£ç¡®çš„ FastAPI å®ä¾‹å‘èµ·è¯·æ±‚ã€‚

## æœ€å°æŠ“å–ç¤ºä¾‹

å¯ä»¥ä½¿ç”¨ `fetcher/minium_get_status.py` è¿›è¡Œç®€å•çš„çŠ¶æ€æŸ¥è¯¢ï¼š

```shell
python fetcher/minium_get_status.py --address 50359163
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ API æ¥å£ï¼š

```shell
curl http://localhost:8000/api/status?id=29e30f45
```

## ç³»ç»Ÿæ¶æ„

åœ¨å¼€å‘å±‚é¢ï¼Œç›®æ ‡å®ç°é«˜å†…èšã€ä½è€¦åˆã€æ˜“äºæ‰©å±•ã€‚

```mermaid
flowchart TD

    A["iOS å¿«æ·æŒ‡ä»¤<br/>1. å…³æ³¨ç‚¹å¿«é€ŸæŸ¥è¯¢"]

    B["React Web SPA<br/>Vite bundle"]

    C["FastAPI API æœåŠ¡"]

    D["é’‰é’‰æœºå™¨äºº<br/>å…¨éƒ¨"]

    E["ProviderManager<br/>æœåŠ¡å•†ç®¡ç†å™¨"]

    F1["NeptuneProvider<br/>å°¼æ™®é¡¿æœåŠ¡å•†"]
    F2["å…¶ä»–æœåŠ¡å•†<br/>å¯æ‰©å±•..."]

    G["Supabase æ•°æ®åº“"]

    %% è¿æ¥å…³ç³»
    A --> |æŸ¥è¯¢| C

    B <--> |AJAX| C

    D --> |webhook| C

    C --> |è¯»å–æ•°æ®| G
    E --> |ç®¡ç†| F1
    E --> |ç®¡ç†| F2
    F1 --> |å®æ—¶æŠ“å–| E
    F2 --> |å®æ—¶æŠ“å–| E
    
    G <--> |å†™å…¥ç¼“å­˜| E
```

æ‰€æœ‰æŸ¥è¯¢æ¥æºï¼ˆReact Web SPAã€é’‰é’‰ã€GitHub Actionï¼‰éƒ½è°ƒç”¨ç»Ÿä¸€ API å’Œ ProviderManagerï¼Œé€»è¾‘å®Œå…¨ä¸é‡å¤ã€‚å‰ç«¯é€šè¿‡ Vite æ„å»ºçš„ React + Apache ECharts-on-AMap å®¢æˆ·ç«¯æ¶ˆè´¹è¿™äº› APIï¼Œç³»ç»Ÿåˆ™ä¿æŒå¤šæœåŠ¡å•†æ¶æ„ä»¥æ”¯æŒå¹¶å‘ç­›é€‰ã€‚

## é¡¹ç›®ç»“æ„

```text
project/
â”œâ”€â”€ fetcher/
â”‚   â”œâ”€â”€ provider_manager.py   # æœåŠ¡å•†ç®¡ç†å™¨
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ provider_base.py  # æœåŠ¡å•†æŠ½è±¡åŸºç±»
â”‚   â”‚   â””â”€â”€ neptune.py        # å°¼æ™®é¡¿æœåŠ¡å•†å®ç°
â”‚   â””â”€â”€ station.py            # å…±äº« Station æ¨¡å‹ï¼ˆCSV è§£æ + hash ç”Ÿæˆï¼‰
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ client.py             # Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–
â”‚   â”œâ”€â”€ station_repo.py       # stations è¡¨ CRUD
â”‚   â”œâ”€â”€ usage_repo.py         # latest/usage è¡¨è¯»å†™
â”‚   â”œâ”€â”€ pipeline.py           # record_usage_data æ•°æ®ç®¡é“
â”‚   â””â”€â”€ __init__.py           # ç»Ÿä¸€æš´éœ² initialize/get/batch æ¥å£
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ api.py                # FastAPI ä¸»æœåŠ¡ï¼ˆç›´æ¥è°ƒç”¨ db/ ä»“åº“ï¼‰
â”‚   â”œâ”€â”€ config.py             # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ”¯æŒæœåŠ¡å•†é…ç½®ï¼‰
â”‚   â””â”€â”€ logging_config.py     # æ—¥å¿—é…ç½®
â”œâ”€â”€ ding/
â”‚   â”œâ”€â”€ bot.py                # é’‰é’‰æœºå™¨äººå°è£…
â”‚   â”œâ”€â”€ webhook.py            # é’‰é’‰ webhook è·¯ç”±
â”‚   â””â”€â”€ commands.py           # å‘½ä»¤è§£æå’Œæ‰§è¡Œ
â”œâ”€â”€ web/                      # React + Vite å‰ç«¯
â”‚   â”œâ”€â”€ package.json          # npm scriptsã€ä¾èµ–
â”‚   â”œâ”€â”€ index.html            # Vite å…¥å£
â”‚   â””â”€â”€ src/                  # App.tsxã€ç»„ä»¶ã€hooksã€æœåŠ¡ã€æ ·å¼
â”œâ”€â”€ script/                   # iOS å¿«æ·æŒ‡ä»¤
â”‚   â”œâ”€â”€ README.md             # å¿«æ·æŒ‡ä»¤ä½¿ç”¨è¯´æ˜
â”‚   â””â”€â”€ *.shortcut            # å¿«æ·æŒ‡ä»¤æ–‡ä»¶
â”œâ”€â”€ run_server.py             # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ serve.sh                  # å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼‰
â””â”€â”€ requirements.txt          # ä¾èµ–åº“
```

## è®¸å¯è¯

ä½¿ç”¨ GPLv3 è®¸å¯è¯ï¼Œè§ [LICENSE](./LICENSE) æ–‡ä»¶

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

è¯·æŸ¥çœ‹ï¼š

- [è¡Œä¸ºå‡†åˆ™](./CODE_OF_CONDUCT.md)
- [è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)
- [Issue æ¨¡æ¿](./.github/ISSUE_TEMPLATE/)
- [Pull Request æ¨¡æ¿](./.github/pull_request_template.md)

![star history](https://api.star-history.com/svg?repos=Phil-Fan/ZJU-Charger&type=Date)

## è‡´è°¢

### åç«¯

- æ„Ÿè°¢ [cyc-987/Charge-in-ZJU: æµ™å¤§å……ç”µæ¡©æŸ¥è¯¢](https://github.com/cyc-987/Charge-in-ZJU) çš„åŸä½œè€… [@cyc-987](https://github.com/cyc-987)ï¼Œä¸ºé¡¹ç›®æä¾›çµæ„Ÿï¼›æ„Ÿè°¢ [ç´«é‡‘æ¸¯å……ç”µæ¡©åœ°å›¾ - CC98 è®ºå›](https://www.cc98.org/topic/6348814) ä¸­åˆ†äº«çš„ ZJG å……ç”µåœ°å›¾ï¼›æ„Ÿè°¢ [æµ™æ±Ÿå¤§å­¦ E æ ¡å›­ç”µå­åœ°å›¾å¹³å°](https://map.zju.edu.cn/index?locale=en_US) ä¸­çš„éƒ¨åˆ†å……ç”µæ¡©ç‚¹ä½ä¿¡æ¯ã€‚
- ä½¿ç”¨ [ç»çº¬åº¦æŸ¥è¯¢å®šä½ ï½œ åæ ‡æ‹¾å–](https://www.mapchaxun.cn/Regeo) è°ƒæ•´æŠ“å–åˆ°çš„é”™è¯¯ç«™ç‚¹åæ ‡ã€‚
- ä½¿ç”¨ [fastapi](https://fastapi.tiangolo.com/) å®ç° API æœåŠ¡ï¼›ä½¿ç”¨ [slowapi](https://github.com/sunhailin-dev/slowapi) å®ç°æ¥å£é™æµåŠŸèƒ½ã€‚
- ä½¿ç”¨ [supabase](https://supabase.com/) å®ç°æ•°æ®åº“åŠŸèƒ½ã€‚
- ä½¿ç”¨ [Caddy](https://caddyserver.com/) å®ç° HTTPS è¯ä¹¦ä¸åå‘ä»£ç†æœåŠ¡ã€‚

### å‰ç«¯

- ä½¿ç”¨ [Apache ECharts](https://echarts.apache.org/) + [echarts-extension-amap](https://github.com/plainheart/echarts-extension-amap) å®Œæˆåœ°å›¾æ¸²æŸ“ã€‚
- ä½¿ç”¨ [Tailwind CSS](https://tailwindcss.com/) è´Ÿè´£ UI æ ·å¼ï¼Œé…åˆ React ç»„ä»¶åŒ–å®ç°å“åº”å¼é¡µé¢ã€‚
- åæ ‡è½¬æ¢ç”±è‡ªå®šä¹‰ `geo` å·¥å…·å®ç°ï¼ˆWGS84 â†” GCJ02 â†” BD09ï¼‰ã€‚

### å…¶ä»–

- ä½¿ç”¨ [minima](https://github.com/jekyll/minima) ä¸»é¢˜ç”Ÿæˆé¡¹ç›®æ–‡æ¡£ã€‚
- ä½¿ç”¨ [huacnlee/autocorrect](https://github.com/huacnlee/autocorrect/), [DavidAnson/markdownlint-cli2-action](https://github.com/DavidAnson/markdownlint-cli2-action) ä¸ [gaurav-nelson/github-action-markdown-link-check](https://github.com/gaurav-nelson/github-action-markdown-link-check) å¯¹ Markdown æ–‡æ¡£è¿›è¡Œè‡ªåŠ¨åŒ–æ£€æŸ¥ã€‚
- ä½¿ç”¨ [black](https://github.com/psf/black) ä¸ [lgeiger/black-action](https://github.com/lgeiger/black-action) å¯¹ Python ä»£ç è¿›è¡Œè‡ªåŠ¨åŒ–æ ¼å¼æ£€æŸ¥ã€‚
- ä½¿ç”¨ [Star History](https://star-history.com/) å®ç° star å†å²ç»Ÿè®¡ã€‚

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…ï¼

![GitHub contributors](https://contrib.rocks/image?repo=Phil-Fan/ZJU-Charger)
